scalar DateTime
scalar JSON

enum QuestionType {
    MULTIPLE_CHOICE
    TRUE_FALSE
    SHORT_ANSWER
}

type User {
    id: Int
    email: String!
    isAdmin: Boolean!
    name: String!
    entries: [Entry!]
}

type Entry {
    id: Int
    title: String!
    quizId: Int!
    authorId: Int!
    author: User!
    answers: JSON!
    createdAt: DateTime!
    updatedAt: DateTime!
}

type Quiz {
    id: Int
    title: String!
    joinCode: String!
    deadline: DateTime
    questions: [Question!]
    createdAt: DateTime!
    updatedAt: DateTime!
    entries: [Entry!]
}

input QuestionInput {
    id: Int
    text: String!
    questionType: QuestionType!
    quizId: Int
    options: [String]
    correctAnswer: String
}

type Question {
    id: Int
    text: String!
    questionType: QuestionType!
    quizId: Int!
    options: [String]
    correctAnswer: String
}

type Query {
    # User Queries
    getAllUsers: [User!]!
    getUser(id: Int!): User

    # Quiz Queries
    getAllQuizzes: [Quiz!]!
    getQuiz(joinCode: String!): Quiz
    getUsersForQuiz(quizId: Int!): [User!]!
    getQuestionsForQuiz(quizId: Int!): [Question!]!

    # Entry Queries
    getAllEntries: [Entry!]!
    getEntriesForUser(userId: Int!): [Entry!]!
    getEntryForUser(quizId: Int!, userId: Int!): Entry

    # Question Queries
    getQuestion(id: Int!): Question
    isQuestionCorrect(questionId: Int!, answer: String!): Boolean!
}

type Mutation {
    # User Mutations
    createUser(email: String!, name: String!, isAdmin: Boolean): User!
    deleteUser(id: Int!): User!
    updateUser(id: Int!, email: String, name: String): User!

    # Entry Mutations
    upsertEntry(quizId: Int!, userId: Int!, title: String!, answers: JSON!): Entry!
    
    # Question Mutations
    createQuestion(text: String!, questionType: QuestionType!, correctAnswer: String, quizId: Int!): Question!
    deleteQuestion(id: Int!): Question!
    updateQuestion(id: Int!, text: String, questionType: QuestionType, correctAnswer: String): Question!
    
    # Quiz Mutations
    createQuiz(title: String!, questions: [QuestionInput], deadline: DateTime): Quiz!
    updateQuiz(id: Int!, title: String): Quiz!
    addQuestionToQuiz(quizId: Int!, questionId: Int!): Quiz!
    removeQuestionFromQuiz(quizId: Int!, questionId: Int!): Quiz!
    deleteQuiz(id: Int!): Quiz!
}

type LeaderboardEntry {
    userId: Int!
    userName: String!
    correctAnswers: Int!
    totalQuestions: Int!
    score: Float!
}

type QuizUpdatePayload {
    quiz: Quiz!
    leaderboard: [LeaderboardEntry!]!
}

type Subscription {
    quizUpdated(quizId: Int!): QuizUpdatePayload!
}